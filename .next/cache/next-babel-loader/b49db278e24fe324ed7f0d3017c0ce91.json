{"ast":null,"code":"import Axios from 'axios';\nimport HttpStatus from 'http-status-codes';\nimport Media from '../middleware/Media';\nimport middleware from '../middleware/middleware';\nimport nextConnect from 'next-connect';\nconst handler = nextConnect();\nhandler.use(middleware);\nexport const config = {\n  api: {\n    bodyParser: false\n  }\n};\nhandler.post(async (req, res) => {\n  try {\n    const file = req.files;\n    const cloudName = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;\n    const url = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;\n    const data = {\n      upload_preset: req.body.upload_preset,\n      file: file.file.path\n    };\n    const options = {\n      // public_id: req.user._id,\n      folder: 'kathekon_blog',\n      transformation: []\n    };\n    const mediaUploader = new Media().init();\n    await mediaUploader.v2.uploader.upload(file.file.path, options, async (error, result) => {\n      if (error) {\n        return res.status(HttpStatus.BAD_REQUEST).json({\n          success: 0,\n          error: err.message\n        });\n      }\n\n      return res.status(HttpStatus.OK).json({\n        success: 1,\n        file: {\n          url: result.secure_url\n        }\n      });\n    }); // const request = await Axios.post(url, data, { headers: { 'content-type': 'multipart/form-data' } });\n    // console.log(request);\n  } catch (err) {\n    console.log(err);\n    res.status(HttpStatus.BAD_REQUEST).json({\n      error: err.message\n    });\n  }\n});\nexport default handler; // export default async function uploadHandler(req, res, next) {\n//   await parseMultipartForm(req, res, next);\n//   const { method } = req;\n//   console.log(req.body);\n//   switch (method) {\n//     case 'GET':\n//       // Get data from your database\n//       res.status(200).json({ method })\n//       break\n//     case 'POST':\n//       // Update or create data in your database\n//       // const cloudName = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;\n//       // const unsignedUploadPreset = 'klhmvqzf';\n//       // const url = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;\n//       // const data = {\n//       //   upload_preset: unsignedUploadPreset,\n//       //   file,\n//       // };\n//       // const request = await Axios.post(url, data, {});\n//       // console.log(request);\n//       res.status(200).json({\n//         success: 1,\n//         file: 'https://res.cloudinary.com/cello/image/upload/v1604750304/suc10txqzeeqz5uet30r.jpg',\n//       });\n//       break;\n//     default:\n//       res.setHeader('Allow', ['GET', 'POST'])\n//       res.status(405).end(`Method ${method} Not Allowed`);\n//       break;\n//   }\n// }","map":null,"metadata":{},"sourceType":"module"}